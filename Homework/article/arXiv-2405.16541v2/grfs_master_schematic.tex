\pgfdeclarelayer{foreground layer}
\pgfsetlayers{main,foreground layer}
\def\scale{0.75}
\def\xeps{0.35}
\def\yeps{0.2}

\definecolor{color1}{RGB}{12,7,134}
\definecolor{color2}{RGB}{118,1,168}
\definecolor{color3}{RGB}{166,32,151}
\definecolor{color4}{RGB}{230,116,86}
\definecolor{color5}{RGB}{250,180,45}


\tikzset{
  % style to apply some styles to each segment of a path
  on each segment/.style={
    decorate,
    decoration={
      show path construction,
      moveto code={},
      lineto code={
        \path [#1]
        (\tikzinputsegmentfirst) -- (\tikzinputsegmentlast);
      },
      curveto code={
        \path [#1] (\tikzinputsegmentfirst)
        .. controls
        (\tikzinputsegmentsupporta) and (\tikzinputsegmentsupportb)
        ..
        (\tikzinputsegmentlast);
      },
      closepath code={
        \path [#1]
        (\tikzinputsegmentfirst) -- (\tikzinputsegmentlast);
      },
    },
  },
  % style to add an arrow in the middle of a path
  mid arrow/.style={postaction={decorate,decoration={
        markings,
        mark=at position .6 with {\arrow[#1]{stealth}}
      }}},
}


\begin{tikzpicture}[node distance={15mm}, thick, main/.style = {draw, circle}] 

\def\textyeps{0.25}
    \begin{scope}[shift = {(7.2,-1.65)}]
    
    \begin{pgfonlayer}{foreground layer}   
    \node[main,line width = 0.5,fill=white,scale=0.5] (1) at (-2.21575*\scale, 2.183375*\scale) {};
    \newcount\mycount;
    \foreach [count=\i] \coord in {(-2.774875*\scale, 2.5685*\scale),(-3.06325*\scale, 1.8445*\scale),(-2.22575*\scale, 1.597125*\scale),(-1.594875*\scale, 3.17525*\scale),(-1.1529625*\scale, 1.987*\scale),(-1.165875*\scale, 2.56575*\scale),(-2.3605*\scale, 2.570375*\scale),(-3.13125*\scale, 1.408*\scale),(-1.45775*\scale, 2.626125*\scale),(-1.3599999999999999*\scale, 1.4446249999999998*\scale),(-1.641875*\scale, 1.1193*\scale),(-2.78725*\scale, 1.3435000000000001*\scale),(-2.4850000000000003*\scale, 3.4305*\scale),(-3.16725*\scale, 2.073375*\scale),(-2.142375*\scale, 3.3128749999999996*\scale),(-3.517875*\scale, 2.42475*\scale),(-3.796375*\scale, 2.159125*\scale),(-3.2432499999999997*\scale, 0.6429875*\scale),(-4.113125*\scale, 2.511*\scale),(-3.549125*\scale, 1.2047375*\scale),(-4.22275*\scale, 1.610125*\scale),(-0.225*\scale, 2.409*\scale),(-4.06475*\scale, 1.3831250000000002*\scale),(-4.301125*\scale, 0.49488750000000004*\scale),(-3.9487499999999995*\scale, 0.3375*\scale),(-5.0893749999999995*\scale, 1.937875*\scale),(-4.855875*\scale, 0.84955*\scale),(-5.168*\scale, 1.527*\scale),(-4.8285*\scale, 2.283875*\scale),(-4.442375*\scale, 3.226*\scale),(-4.9585*\scale, 1.291125*\scale),(-3.8698749999999995*\scale, 3.4715000000000003*\scale),(-4.743*\scale, 0.418825*\scale)}{
    \tikzmath{\mycount=\i+1;}
    \node[main,line width = 0.5 ,fill=white,scale=0.5] (\the\mycount) at \coord {};}

  \node[scale=0.75] at (-2,-0.79 + \textyeps) {graph random walks};

    
    \end{pgfonlayer}
    \draw[black!30,-,line width = 0.5] (2) -- (1);
\draw[black!30,-,line width = 0.5] (3) -- (1);
\draw[black!30,-,line width = 0.5] (3) -- (2);
\draw[black!30,-,line width = 0.5] (4) -- (1);
\draw[black!30,-,line width = 0.5] (4) -- (2);
\draw[black!30,-,line width = 0.5] (4) -- (3);
\draw[black!30,-,line width = 0.5] (5) -- (1);
\draw[black!30,-,line width = 0.5] (6) -- (1);
\draw[black!30,-,line width = 0.5] (7) -- (1);
\draw[black!30,-,line width = 0.5] (7) -- (5);
\draw[black!30,-,line width = 0.5] (7) -- (6);
\draw[black!30,-,line width = 0.5] (8) -- (1);
\draw[black!30,-,line width = 0.5] (8) -- (2);
\draw[black!30,-,line width = 0.5] (8) -- (3);
\draw[black!30,-,line width = 0.5] (8) -- (4);
\draw[black!30,-,line width = 0.5] (9) -- (1);
\draw[black!30,-,line width = 0.5] (9) -- (3);
\draw[black!30,-,line width = 0.5] (10) -- (1);
\draw[black!30,-,line width = 0.5] (10) -- (5);
\draw[black!30,-,line width = 0.5] (10) -- (6);
\draw[black!30,-,line width = 0.5] (11) -- (1);
\draw[black!30,-,line width = 0.5] (12) -- (1);
\draw[black!30,-,line width = 0.5] (12) -- (4);
\draw[black!30,-,line width = 0.5] (13) -- (1);
\draw[black!30,-,line width = 0.5] (13) -- (2);
\draw[black!30,-,line width = 0.5] (13) -- (3);
\draw[black!30,-,line width = 0.5] (13) -- (4);
\draw[black!30,-,line width = 0.5] (14) -- (1);
\draw[black!30,-,line width = 0.5] (14) -- (2);
\draw[black!30,-,line width = 0.5] (15) -- (1);
\draw[black!30,-,line width = 0.5] (15) -- (2);
\draw[black!30,-,line width = 0.5] (16) -- (1);
\draw[black!30,-,line width = 0.5] (16) -- (2);
\draw[black!30,-,line width = 0.5] (17) -- (1);
\draw[black!30,-,line width = 0.5] (18) -- (2);
\draw[black!30,-,line width = 0.5] (18) -- (9);
\draw[black!30,-,line width = 0.5] (19) -- (3);
\draw[black!30,-,line width = 0.5] (20) -- (3);
\draw[black!30,-,line width = 0.5] (21) -- (3);
\draw[black!30,-,line width = 0.5] (21) -- (17);
\draw[black!30,-,line width = 0.5] (22) -- (3);
\draw[black!30,-,line width = 0.5] (22) -- (9);
\draw[black!30,-,line width = 0.5] (22) -- (17);
\draw[black!30,-,line width = 0.5] (22) -- (18);
\draw[black!30,-,line width = 0.5] (23) -- (6);
\draw[black!30,-,line width = 0.5] (23) -- (7);
\draw[black!30,-,line width = 0.5] (24) -- (9);
\draw[black!30,-,line width = 0.5] (24) -- (13);
\draw[black!30,-,line width = 0.5] (24) -- (15);
\draw[black!30,-,line width = 0.5] (24) -- (17);
\draw[black!30,-,line width = 0.5] (24) -- (18);
\draw[black!30,-,line width = 0.5] (24) -- (19);
\draw[black!30,-,line width = 0.5] (24) -- (20);
\draw[black!30,-,line width = 0.5] (24) -- (21);
\draw[black!30,-,line width = 0.5] (24) -- (22);
\draw[black!30,-,line width = 0.5] (25) -- (22);
\draw[black!30,-,line width = 0.5] (25) -- (24);
\draw[black!30,-,line width = 0.5] (26) -- (22);
\draw[black!30,-,line width = 0.5] (26) -- (24);
\draw[black!30,-,line width = 0.5] (27) -- (22);
\draw[black!30,-,line width = 0.5] (27) -- (24);
\draw[black!30,-,line width = 0.5] (28) -- (22);
\draw[black!30,-,line width = 0.5] (28) -- (24);
\draw[black!30,-,line width = 0.5] (29) -- (22);
\draw[black!30,-,line width = 0.5] (29) -- (24);
\draw[black!30,-,line width = 0.5] (30) -- (20);
\draw[black!30,-,line width = 0.5] (30) -- (22);
\draw[black!30,-,line width = 0.5] (30) -- (24);
\draw[black!30,-,line width = 0.5] (31) -- (17);
\draw[black!30,-,line width = 0.5] (31) -- (30);
\draw[black!30,-,line width = 0.5] (32) -- (22);
\draw[black!30,-,line width = 0.5] (32) -- (24);
\draw[black!30,-,line width = 0.5] (32) -- (30);
\draw[black!30,-,line width = 0.5] (33) -- (17);
\draw[black!30,-,line width = 0.5] (33) -- (20);
\draw[black!30,-,line width = 0.5] (33) -- (31);
\draw[black!30,-,line width = 0.5] (34) -- (24);
\draw[black!30,-,line width = 0.5] (34) -- (32);
\draw[black!30,-,line width = 0.5] (6) -- (11);
\draw[black!30,-,line width = 0.5] (11) -- (12);
\draw[black!30,-,line width = 0.5] (5) -- (16);
\draw[black!30,-,line width = 0.5] (32) -- (27);

\draw[color1,very thick,-,postaction={decorate},postaction={on each segment={mid arrow}}] (1) -- (8) -- (2);
\draw[color2,very thick,-,postaction={decorate},postaction={on each segment={mid arrow}}] (1) -- (10) -- (5)-- (16);
\draw[color3,very thick,-,postaction={decorate},postaction={on each segment={mid arrow}}] (1) -- (12) -- (11)--(6)-- (23) -- (7);
\draw[color4,very thick,-,postaction={decorate},postaction={on each segment={mid arrow}}] (1) -- (4) -- (13)-- (9) -- (19) -- (24) -- (22)--(28);
\draw[color5,very thick,-,postaction={decorate},postaction={on each segment={mid arrow}}] (1) -- (15) -- (24) -- (18) -- (17) -- (33) -- (20) -- (30) -- (32) -- (27);

\end{scope}



    \def\xscale{0.35}
%    \fill[color = color1] (0,0) rectangle (\xscale,0.6);
%    \fill[color = color2] (\xscale,0) rectangle (\xscale*2,0.6);
%    \fill[color = color3] (\xscale*2,0) rectangle (\xscale*3,0.6);
%    \fill[color = color4] (\xscale*3,0) rectangle (\xscale*4,0.6);
%    \fill[color = color5] (\xscale*4,0) rectangle (\xscale*5,0.6);

    \def\xa{0.2}
    \def\xb{0.5}
    \def\xc{0.85}
    \def\xd{1.4}
       

    \fill [color1, domain=0:\xa] plot    (({\x},{1.3/(3^\x)}) |- (0,0);
    \fill [color2, domain=\xa:\xb] plot    (({\x},{1.3/(3^\x)}) |- (\xa,0);
    \fill [color3, domain=\xb:\xc] plot    (({\x},{1.3/(3^\x)}) |- (\xb,0);
    \fill [color4, domain=\xc:\xd] plot    (({\x},{1.3/(3^\x)}) |- (\xc,0);
    \fill [color5, domain=\xd:2.0] plot    (({\x},{1.3/(3^\x)}) |- (\xd,0);
    \draw[line width = 0.5, ->] (0,0) -- (0,1.5);
    \draw[line width = 0.5, ->] (0,0) -- (2.2,0);
    \draw[domain=0:2,smooth,variable=\x,black, line width=0.5] plot ({\x},{1.3/(3^\x)});

    \def\yoffset{-1}
    \fill [color1, domain=0:\xa] plot    (({\x},{-1.3/(3^\x)+\yoffset+0.6}) |- (0,\yoffset+0.6);
    \fill [color2, domain=\xa:\xb] plot    (({\x},{-1.3/(3^\x)+\yoffset+0.6}) |- (\xa,0+\yoffset+0.6);
    \fill [color3, domain=\xb:\xc] plot    (({\x},{-1.3/(3^\x)+\yoffset+0.6}) |- (\xb,0+\yoffset+0.6);
    \fill [color4, domain=\xc:\xd] plot    (({\x},{-1.3/(3^\x)+\yoffset+0.6}) |- (\xc,0+\yoffset+0.6);
    \fill [color5, domain=\xd:2.0] plot    (({\x},{-1.3/(3^\x)+\yoffset+0.6}) |- (\xd,0+\yoffset+0.6);
    \draw[line width = 0.5, ->] (0,0) -- (0,1.5);
    \draw[line width = 0.5, ->] (0,0) -- (2.2,0);
    \draw[domain=0:2,smooth,variable=\x,black, line width=0.5] plot ({\x},{1.3/(3^\x)});

    
    \draw[line width = 0.5, ->] (0,0+\yoffset+0.6) -- (0,-1.5+\yoffset+0.6);
    \draw[line width = 0.5, ->] (0,0+\yoffset+0.6) -- (2.2,0+\yoffset+0.6);
    \draw[domain=0:2,smooth,variable=\x,black, line width=0.5] plot ({\x},{-1.3/(3^\x) + \yoffset + 0.6});
    

    \node[circle, scale = 0.1] (1) at (\xa/2 , 0) {};
    \node[circle, scale = 0.1] (2) at ({\xa/2} , \yoffset + 0.6) {};
    \node[circle, scale = 0.1] (3) at ({(\xa+\xb)/2} , 0) {};
    \node[circle, scale = 0.1] (4) at ({(\xa+\xb)/2} , \yoffset + 0.6) {};
    \node[circle, scale = 0.1] (5) at ({(\xc+\xb)/2} , 0) {};
    \node[circle, scale = 0.1] (6) at ({(\xc+\xb)/2} , \yoffset + 0.6) {};
    \node[circle, scale = 0.1] (7) at ({(\xc+\xd)/2} , 0) {};
    \node[circle, scale = 0.1] (8) at ({(\xc+\xd)/2} , \yoffset + 0.6) {};
    \node[circle, scale = 0.1] (9) at ({(2.0+\xd)/2} , 0) {};
    \node[circle, scale = 0.1] (10) at ({(2.0+\xd)/2} , \yoffset + 0.6) {};

    \def\amp{0.3pt}
    \def\seglength{2.8pt}
    \draw[line width = 0.25, color = black!50, decorate,decoration={coil,segment length= \seglength, aspect = 0, amplitude = \amp}] (1) -- (10);
    \draw[ line width = 0.25, color = black!50, decorate,decoration={coil,segment length= \seglength, aspect = 0, amplitude = \amp} ] (4) -- (7);
    \draw[ line width = 0.25, color = black!50, decorate,decoration={coil,segment length= \seglength, aspect = 0, amplitude = \amp}] (6) -- (5);
    \draw[ line width = 0.25, color = black!50, decorate,decoration={coil,segment length= \seglength, aspect = 0, amplitude = \amp}] (8) -- (9);
    \draw[ line width = 0.25, color = black!50, decorate,decoration={coil,segment length= \seglength, aspect = 0, amplitude = \amp}] (2) -- (3);

    %\node[scale=1.0] at (1.1,-2.75) {$\sigma$ \hspace{0.5mm}\lstinline{= 24351}};

    \def\circheight{0.2}
    \def\circsize{0.5}
    \node[draw, circle, scale = \circsize, fill = white, line width = 0.25] at (\xa/2 , \circheight){};
   \node[scale=0.4] at (\xa/2 , \circheight) {$1$};
    \node[draw, circle, scale = \circsize, fill = white, line width = 0.25] at ({(\xa+\xb)/2} , \circheight){};
    \node[scale=0.4] at ({(\xa+\xb)/2},\circheight) {$2$};
    \node[draw, circle, scale = \circsize, fill = white, line width = 0.25] at ({(\xc+\xb)/2}, \circheight){};
    \node[scale=0.4] at ({(\xc+\xb)/2},\circheight) {$3$};
    \node[draw, circle, scale = \circsize, fill = white, line width = 0.25] at ({(\xd+\xc)/2}, \circheight){};
    \node[scale=0.4] at ({(\xd+\xc)/2},\circheight) {$4$};
    \node[draw, circle, scale = \circsize, fill = white, line width = 0.25] at ({(\xd+2.0)/2}, \circheight){};
    \node[scale=0.4] at ({(\xd+2.0)/2},\circheight) {$5$};

    \node[draw, circle, scale = \circsize, fill = white, line width = 0.25] at (\xa/2 , -\circheight + \yoffset+0.6){};
   \node[scale=0.4] at (\xa/2 , -\circheight + \yoffset+0.6) {$1$};
    \node[draw, circle, scale = \circsize, fill = white, line width = 0.25] at ({(\xa+\xb)/2} , -\circheight + \yoffset+0.6){};
    \node[scale=0.4] at ({(\xa+\xb)/2},-\circheight + \yoffset+0.6) {$2$};
    \node[draw, circle, scale = \circsize, fill = white, line width = 0.25] at ({(\xc+\xb)/2}, -\circheight + \yoffset+0.6){};
    \node[scale=0.4] at ({(\xc+\xb)/2},-\circheight + \yoffset+0.6) {$3$};
    \node[draw, circle, scale = \circsize, fill = white, line width = 0.25] at ({(\xd+\xc)/2}, -\circheight + \yoffset+0.6){};
    \node[scale=0.4] at ({(\xd+\xc)/2},-\circheight + \yoffset+0.6) {$4$};
    \node[draw, circle, scale = \circsize, fill = white, line width = 0.25] at ({(\xd+2.0)/2}, -\circheight + \yoffset+0.6){};
    \node[scale=0.4] at ({(\xd+2.0)/2},-\circheight + \yoffset+0.6) {$5$};

    \node[scale=0.75] at (1.1,{-2.44 + \textyeps}) {matching between quantiles};
    \node[scale=0.75] at (0.0,1.75) {$p$};
    \node[scale=0.75] at (2.4,0.0) {$l$};
    
    \begin{scope}[shift = {(-3.8,-1.44 )}]

    \node[scale=0.75] at (1.25,-1+\textyeps) {$\pi^{(\sigma)}$};
    
    \fill[fill = color1!20 ] (0,0.5) rectangle (0.5,1.0) ;
    \fill[fill = color1!20 ] (0.5,1.5) rectangle (1.0,2.0) ;
    \fill[fill = color1!20 ] (1.0,1.0) rectangle (1.5,1.5) ;
    \fill[fill = color1!20 ] (1.5,2.0) rectangle (2.0,2.5) ;
    \fill[fill = color1!20 ] (2.0,0.5) rectangle (2.5,0.0) ;    
    \draw[step=0.5,black,line width = 0.5] (0,0) grid (2.5,2.5);

    \end{scope}
    
    

\end{tikzpicture}